
pipeline {
	agent any

	stages {
		stage ("Build the package") {
			steps {
				node ("build-ser") {
					print ("Clone the git repo")
					checkout scm

					print ("Building the war package")
					sh "mvn install"

					print ("Stash the package")
					stash ( includes: "target/hello-web.war", name: "package")
				}
			}
		}
		stage ("Deploy the package") {
			steps {
				node ("deploy-ser") {
					print ("Unstash the package")
					unstash (name: "package")

					print ("Delete the old package if present")
					sh "rm -rf /usr/local/tomcat/webapps/hello-web.war"

					print ("Copy the new package")
					sh "cp /app/build_server/workspace/new pipe/target/hello-web.war /usr/local/tomcat/webapps/"
				}
			}
		}
	}
	

